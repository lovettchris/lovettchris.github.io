<!DOCTYPE html>
<html lang="en">
<head>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://lovettchris.github.io/posts/archai/">
    <link rel="shortcut icon" href="img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Find better models! - Lovett Software</title>
    <link href="/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/highlight.css">
    <link href="../../css/main.css" rel="stylesheet">
    <link href="../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/bootstrap-3.3.7.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Archai can find better models", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="/js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-UA-89203408-1', 'lovettsoftware.com');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

      <h2 id="archai-can-find-better-models">Archai can find better models</h2>
<p>So I&rsquo;ve been working on this cool framework called <a href="https://microsoft.github.io/archai/">Archai</a>
which can automate the process of finding better Neural Network model architectures.  I had lots of
fun hooking it up to Azure ML so we could run an end-to-end model search optimizing the models found
so they run well on Qualcomm 888 chipsets, specifically the DSP processor which runs a quantized
version of the model.</p>
<p>One fun example is a image segmentation model trained on a
<a href="https://github.com/microsoft/FaceSynthetics">synthetic dataset</a>:</p>
<p><img alt="faces" src="face_synthetics.png" /></p>
<p>These models can detect 19 categories of pixel including the background, skin, eyes, ears, nose,
lips, clothing, hair, beard, and so on all in about 2 milliseconds on the Qualcomm DSP chip which is
simply amazing to me.</p>
<p>First you define a <a href="https://github.com/microsoft/archai/tree/main/tasks/face_segmentation">search
space</a> starting with a
baseline model architecture, then tell it to go!  We ran this in Azure using the Evolutionary Pareto
Search algorithm and it was fun to watch the models appear, steadly improving the pareto curve:</p>
<p><img alt="pareto evolution" src="animation.gif" /></p>
<p>This resulting models have an inference time that span 2.5ms all the way up to 15ms.  When finished we do
full training on the final best models on the pareto frontier which gave us the following.
This chart is showing a nice jump up in the validation accuracies (measured as intersection over union (IOU) score)
resulting from full training.  The Archai search uses only partial training with only 1 epoch
in order to save on training costs.  For the search algorithm to find the best models it only needs
relative comparison on model accuracies and 1 epoch is enough to get those relative differences.</p>
<p><img alt="f1" src="full_training.png" /></p>
<p>Now we have some fully trained models we can test these
models on the Qualcomm devices to measure the F1 scores:</p>
<p><img alt="final" src="final_results.png" /></p>
<p>Here the F1 score almost reaches 92% and the really fast models that are down under 2ms are still
above 84% accuracy. This is super cool. You can then pick a model from this pareto curve that
satisfies your constraints.  For example, some applications may have strict accuracy requirement,
some have a strict latency budget and power usage goal. For example, if your inference time budget
requires the model run in under 4ms then you will need to pick a model on the left of that time.
On the other hand if accuracy is all that matters you would pick the biggest slowest model on the right.
This is why Archai produces models on the entire pareto frontier. There is no one best model, it
depends on your application.</p>
<p>To read about the full workflow and how we made all this happen in Azure ML
see the <a href="https://github.com/microsoft/archai/blob/main/tasks/face_segmentation/aml/readme.md">readme</a></p>
<p>The whole thing cost about $1000 in Azure training time, which may seem expensive, but that&rsquo;s only a
few hours for an &ldquo;AI Whisperer&rdquo; which is a red hot job market right now.  Besides if your model is
going into production and was taking 10ms before Archai search and is now taking 2ms, that 5 times
speedup will come back in inference dollars saved, or real customer satisfaction in terms of greatly
reduced battery usage on a phone, both are well worth the investment in Neural Architecture Search.</p>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../fun_with_dart/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../fun_with_dart/" class="btn btn-xs btn-link">
        Fun with Dart
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../nrf5340_pixel/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../nrf5340_pixel/" class="btn btn-xs btn-link">
        LE audio with the nrf5340 rocks
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">

  <section class="footer-join pt-40 pb-80">
  <div class="container-fluid">
    <div class="row text-center">
      <div class="col-sm-8 col-sm-offset-2">
      </div>
    </div>
    <div class="row">
      Lovett Software
   </div>
  </div>
</section>
</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>