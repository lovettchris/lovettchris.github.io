<!DOCTYPE html>
<html lang="en">
<head>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://lovettchris.github.io/posts/ada_kiosk/">
    <link rel="shortcut icon" href="img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Ada Kiosk - Lovett Software</title>
    <link href="/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/highlight.css">
    <link href="../../css/main.css" rel="stylesheet">
    <link href="../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/bootstrap-3.3.7.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Ada Kiosk", url: "#_top", children: [
              {title: "Stop Windows 11 Upgrade?", url: "#stop-windows-11-upgrade" },
              {title: "Reset", url: "#reset" },
          ]},
        ];

    </script>
    <script src="/js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-UA-89203408-1', 'lovettsoftware.com');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

      <h1 id="ada-kiosk">Ada Kiosk</h1>
<p>So I needed to run my nice <a href="https://github.com/microsoft/ada/tree/main/AdaKiosk">AdaKiosk app</a> in locked down kiosk mode
on my Surface Pro device so it can accompany the awesome <a href="https://www.microsoft.com/artist-in-residence/collaborations/ada/">Ada Installation in Microsoft
Research</a></p>
<p><img alt="thumb" src="thumbnail.png" /></p>
<p>Click here to <a href="AdaKioskBoot.mp4">watch a boot demo video.</a>.</p>
<p>And I already had the app, written in .NET 5.0 WPF.  All I needed
to do then is make it run in Kiosk mode right?</p>
<p>Well it turns out that Windows 10 and 11 Kiosk mode do not support
running Desktop apps and my WPF app is a desktop app.  I would need to
port it to UWP but I can&rsquo;t do that for other reasons.  Believe me I
tried, the WPF app will not run in Kiosk mode, I just get a blank screen.</p>
<p>But fortunately there&rsquo;s another feature of Windows 10 called
<a href="https://docs.microsoft.com/en-us/windows/configuration/lock-down-windows-10-to-specific-apps">Multi-app AssignedAccess</a>.  Getting this to
work was a bit tricky, so I&rsquo;m sharing the info here.</p>
<p>First off there&rsquo;s a known bug in Windows 11 that blocks this from working due to the <a href="https://answers.microsoft.com/en-us/windows/forum/all/tablet-mode-in-window-11/d5a312f2-aa5e-4427-9b4e-7d0cc98f90ec">missing &ldquo;tablet
mode&rdquo;</a>
so I had to revert my device back to Windows 10.  There&rsquo;s a <a href="https://answers.microsoft.com/en-us/windows/forum/all/downgrade-from-windows-11-to-windows-10/84a2416d-ccfb-4d87-9eee-e1056591e91f">nice feature of Windows
11</a>
that makes this easy.</p>
<p>Then I had to create a new user account and enable AutoLogon.  But you can&rsquo;t do that if Windows Hello is enabled, so I
had to remove my Windows Hello Pin, then I can setup this new account for auto login by using <code>NETPlwiz</code> as <a href="https://www.techjunkie.com/setup-auto-login-windows-10/">shown
here</a>.  Once auto-login is working, all I need is to setup
multi-app assigned access, which will lock down the device and restrict allowed apps and make it run automatically on
reboot.</p>
<p>The following XML file achieves this:</p>
<pre><code class="language-xml">&lt;?xml version =&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;AssignedAccessConfiguration
    xmlns=&quot;http://schemas.microsoft.com/AssignedAccess/2017/config&quot;
    xmlns:rs5=&quot;http://schemas.microsoft.com/AssignedAccess/201810/config&quot;
    &gt;
    &lt;Profiles&gt;
        &lt;Profile Id=&quot;{fe3b713e-7ce1-4021-8ac9-fab8717713fb}&quot;&gt;
            &lt;AllAppsList&gt;
                &lt;AllowedApps&gt;
                    &lt;App DesktopAppPath=&quot;c:\temp\AdaKiosk\AdaKiosk.exe&quot; rs5:AutoLaunch=&quot;true&quot;/&gt;
                &lt;/AllowedApps&gt;
            &lt;/AllAppsList&gt;
            &lt;StartLayout&gt;
                &lt;![CDATA[&lt;LayoutModificationTemplate xmlns:defaultlayout=&quot;http://schemas.microsoft.com/Start/2014/FullDefaultLayout&quot; xmlns:start=&quot;http://schemas.microsoft.com/Start/2014/StartLayout&quot; Version=&quot;1&quot; xmlns=&quot;http://schemas.microsoft.com/Start/2014/LayoutModification&quot;&gt;
                      &lt;LayoutOptions StartTileGroupCellWidth=&quot;6&quot; /&gt;
                      &lt;DefaultLayoutOverride&gt;
                        &lt;StartLayoutCollection&gt;
                          &lt;defaultlayout:StartLayout GroupCellWidth=&quot;6&quot;&gt;
                            &lt;start:Group Name=&quot;Ada&quot;&gt;
                              &lt;start:DesktopApplicationTile Size=&quot;4x4&quot; Column=&quot;0&quot; Row=&quot;0&quot; DesktopApplicationLinkPath=&quot;c:\temp\AdaKiosk\AdaKiosk.lnk&quot; /&gt;
                            &lt;/start:Group&gt;
                          &lt;/defaultlayout:StartLayout&gt;
                        &lt;/StartLayoutCollection&gt;
                      &lt;/DefaultLayoutOverride&gt;
                    &lt;/LayoutModificationTemplate&gt;
                ]]&gt;
            &lt;/StartLayout&gt;
            &lt;Taskbar ShowTaskbar=&quot;false&quot;/&gt;
        &lt;/Profile&gt;
    &lt;/Profiles&gt;
    &lt;Configs&gt;
        &lt;Config&gt;
            &lt;Account&gt;adatablet\ada&lt;/Account&gt;
            &lt;DefaultProfile Id=&quot;{fe3b713e-7ce1-4021-8ac9-fab8717713fb}&quot;/&gt;
        &lt;/Config&gt;
    &lt;/Configs&gt;
&lt;/AssignedAccessConfiguration&gt;
</code></pre>
<p>Notice I had to also create a shortcut to the app for the start menu.
Apparently this must be a shortcut (.lnk file).</p>
<p>I decided to skip the provisioning package approach and went for the
PowerShell.  This can be done using the <a href="https://docs.microsoft.com/en-us/windows/configuration/kiosk-mdm-bridge">MDM Bridge WMI Provider</a>.
Note: step (2) in this page is critical.  The powershell script must be run
from a special <code>cmd.exe</code> prompt that is created using <code>psexec.exe -i -s cmd.exe</code>.</p>
<p>The script is:</p>
<pre><code class="language-powershell">$nameSpaceName=&quot;root\cimv2\mdm\dmmap&quot;
$className=&quot;MDM_AssignedAccess&quot;
$obj = Get-CimInstance -Namespace $namespaceName -ClassName $className
Write-Host &quot;got instance $obj.Configuration&quot;
Add-Type -AssemblyName System.Web
$xml = Get-Content -Path &quot;AssignedAccessConfig.xml&quot; -Encoding &quot;utf8&quot; | Out-String
$html = [System.Web.HttpUtility]::HtmlEncode($xml)
$obj.Configuration = $html
Set-CimInstance -CimInstance $obj
</code></pre>
<p>Where the xml file is the one I included above.  The HtmlEncode here is a mystery, but it is required!</p>
<p>That&rsquo;s it.  Reboot and bingo you get the auto-login and auto-start of my kiosk app.  Nice.  Everything is pretty nicely
locked down. One trick I tested was to see if I could use the soft keyboard to jump over to the Keyboard Settings and
from there you can mess with any settings, but that stops with &ldquo;Blocked by your system administrator&rdquo;. Cool.  I could
even extend this and have multiple apps selectable from a customized start page if I wanted to.</p>
<h2 id="stop-windows-11-upgrade">Stop Windows 11 Upgrade?</h2>
<p>So now I have to stop Windows 11 upgrades from happening or even showing up in the UI because Windows 11 will break my
Kiosk. I did that using the Group Policy Editor trick <a href="https://www.howtogeek.com/765377/how-to-block-the-windows-11-update-from-installing-on-windows-10/#autotoc_anchor_2">shown
here</a>.
This removes all the prompts telling me to updade to Windows 11.</p>
<h2 id="reset">Reset</h2>
<p>It&rsquo;s also handy to know how to undo all this, and the following script
removes the Assigned Access configuration:</p>
<pre><code class="language-powershell">$nameSpaceName=&quot;root\cimv2\mdm\dmmap&quot;
$className=&quot;MDM_AssignedAccess&quot;
$obj = Get-CimInstance -Namespace $namespaceName -ClassName $className
Write-Host ($obj | Format-List | Out-String)
$obj.Configuration = $null
Set-CimInstance -CimInstance $obj
</code></pre>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../wpf_animating_bar_chart/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../wpf_animating_bar_chart/" class="btn btn-xs btn-link">
        WPF Animating Bar Chart
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../lean/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../lean/" class="btn btn-xs btn-link">
        Lean Programming
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">

  <section class="footer-join pt-40 pb-80">
  <div class="container-fluid">
    <div class="row text-center">
      <div class="col-sm-8 col-sm-offset-2">
      </div>
    </div>
    <div class="row">
      Lovett Software
   </div>
  </div>
</section>
</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>